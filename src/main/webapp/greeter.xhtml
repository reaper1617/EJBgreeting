<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <title>ejb-in-war</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js" type="text/javascript"></script>

    <script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false);
    function hideURLbar(){ window.scrollTo(0,1); } </script>
    <!--// Meta tag Keywords -->

    <link rel="stylesheet" href="resources/web/css/flexslider.css" type="text/css" media="all" /><!-- for testimonials -->

    <!-- css files -->
    <link rel="stylesheet" href="resources/web/css/bootstrap.css"/> <!-- Bootstrap-Core-CSS -->
    <link rel="stylesheet" href="resources/web/css/style.css" type="text/css" media="all" /> <!-- Style-CSS -->
    <link rel="stylesheet" href="resources/web/css/font-awesome.css"/> <!-- Font-Awesome-Icons-CSS -->
    <!-- //css files -->

    <!-- web-fonts -->
    <link href="//fonts.googleapis.com/css?family=Raleway:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&amp;subset=latin-ext" rel="stylesheet"/>
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i&amp;subset=cyrillic,cyrillic-ext,greek,greek-ext,latin-ext,vietnamese" rel="stylesheet"/>
    <!-- //web-fonts -->
</head>

<body>
<div class="slider">
    <div class="callbacks_container">
        <ul class="rslides" id="slider">
            <li>
                <div class="w3layouts-banner-top w3layouts-banner-top1">
                    <div class="banner-dott">
                        <div class="container">
                            <div class="slider-info">
                                <h1>Greeter Service</h1>
                                <div id="container">

                                    <!--<h:form id="greetForm">-->
                                    <!--<h:panelGrid columns="3">-->
                                    <!--<h:outputLabel>Name:</h:outputLabel>-->
                                    <!--<h:inputText value="#{name}" />-->
                                    <!--<h:commandButton id="add" value="Greet"-->
                                    <!--action="#{greeter.setName(name)}">-->
                                    <!--</h:commandButton>-->
                                    <!--</h:panelGrid>-->
                                    <!--</h:form>-->


                                    <h:form id="ordersListForm">
                                        <h:dataTable value="#{greeter.orders}" var="item">
                                            <h:column>
                                                <f:facet name="header">
                                                    <h:outputText value="Personal number"/>
                                                </f:facet>
                                                #{item.id}
                                            </h:column>
                                            <h:column>
                                                <f:facet name="header">
                                                    <h:outputText value="Description"/>
                                                </f:facet>
                                                #{item.description}
                                            </h:column>
                                            <h:column>
                                                <f:facet name="header">
                                                    <h:outputText value="Date/Time"/>
                                                </f:facet>
                                                #{item.date}
                                            </h:column>
                                            <h:column>
                                                <f:facet name="header">
                                                    <h:outputText value="Status"/>
                                                </f:facet>
                                                #{item.status}
                                            </h:column>
                                        </h:dataTable>
                                        <h:commandButton style="display:none" id="tableUpdate" value="tableUpdate"
                                                         action="#{greeter.getOrders}">
                                        </h:commandButton>
                                    </h:form>

                                    <h:form id="statsForm">
                                        <h:panelGrid columns="2">
                                            <h:outputLabel>Trucks total:</h:outputLabel>
                                            <h:outputLabel value="#{greeter.numOfTrucksTotal}" />
                                        </h:panelGrid>
                                        <h:panelGrid columns="2">
                                            <h:outputLabel>Trucks free:</h:outputLabel>
                                            <h:outputLabel value="#{greeter.numOfTrucksFree}" />
                                        </h:panelGrid>
                                        <h:panelGrid columns="2">
                                            <h:outputLabel>Trucks (not ready):</h:outputLabel>
                                            <h:outputLabel value="#{greeter.numOfTrucksNotReady}" />
                                        </h:panelGrid>
                                        <h:panelGrid columns="2">
                                            <h:outputLabel>Trucks executing orders:</h:outputLabel>
                                            <h:outputLabel value="#{greeter.numOfTrucksExecutingOrders}" />
                                        </h:panelGrid>
                                        <h:panelGrid columns="2">
                                            <h:outputLabel>Drivers total:</h:outputLabel>
                                            <h:outputLabel value="#{greeter.numOfDriversTotal}" />
                                        </h:panelGrid>
                                        <h:panelGrid columns="2">
                                            <h:outputLabel>Drivers free:</h:outputLabel>
                                            <h:outputLabel value="#{greeter.numOfDriversFree}" />
                                        </h:panelGrid>
                                        <h:panelGrid columns="2">
                                            <h:outputLabel>Drivers executing orders:</h:outputLabel>
                                            <h:outputLabel value="#{greeter.numOfDriversExecutingOrders}" />
                                        </h:panelGrid>
                                        <h:commandButton style="display:none" id="statsUpdate" value="statsUpdate"
                                                         action="#{greeter.getOrders}">
                                        </h:commandButton>
                                    </h:form>
                                    <h:form id="response">
                                        <h:panelGrid columns="2">
                                            <h:outputLabel>Last action:</h:outputLabel>
                                            <h:outputLabel value="#{greeter.message}" />
                                        </h:panelGrid>
                                    </h:form>

                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </li>
        </ul>
    <div class="clearfix"></div>
    </div>
</div>


<script type="text/javascript">
    // var uri = "ws://" + document.location.host + document.location.pathname +
    var uri = "ws://localhost:8085/ejbgreeting/myendpoint";
    var webSocket = new WebSocket(uri);

    webSocket.onerror = function (ev) {
      webSocket = new WebSocket(uri);
    };

    webSocket.onopen = function (ev) {
        // alert("Socket is opened!");

    };
    webSocket.onmessage = function (ev) {
        // alert("Socket: on message!");
        // alert("received data:" + ev.data.toString());
        var parsed = JSON.parse(ev.data.toString());
        // alert("parsed:" + parsed);
        if (parsed.action === 'ORDER_CREATED' || parsed.action === 'ORDER_UPDATED' || parsed.action === 'ORDER_DELETED'){
            // alert("action=" + parsed.action);
            document.getElementById('ordersListForm:tableUpdate').click();
        }
        if (parsed.action === 'STATS_UPDATED'){
            // alert("action=" + parsed.action);
            document.getElementById('statsForm:statsUpdate').click();
        }
    };
    webSocket.onclose = function (ev) {
        // alert("Socket: on close!")
    };



</script>
</body>



</html>