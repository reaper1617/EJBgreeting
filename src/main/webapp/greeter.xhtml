<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core" xmlns:p="http://xmlns.jcp.org/jsf/composite"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">


<head>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
    <meta http-equiv="refresh" content="600"/>
    <title>ejb-in-war</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"/>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>

    <style type="text/css">

       .custom-font-style{
           color: black;
           font-family: Stencil;
           font-size: 24px;
       }

        .body-pic{
        background: url("/ejbgreeting/backgr.jpg") no-repeat;
        -moz-background-size: 100%;
        -webkit-background-size: 100%;
        -o-background-size: 100%;
        background-size: 100%; }
        .table-row-names {
            width: 400px;
            color: black;
            font-family: Stencil;
            font-size: 24px;
        }

        .table-row-vals {
            width: 400px;
            color: black;
            font-family: "Stencil";
            font-size: 24px;
        }
    </style>

</head>

<body class="body-pic">
<div>
    <div class="container-fluid">
        <nav class="nav nav-tabs bg-dark navbar-dark fixed-top">
            <a class="navbar-brand" href="#">WWL Client</a>
            <!-- Nav tabs -->
        </nav>
    </div>

    <div id="container">
        <div align="center">
            <h:form id="ordersListForm">
                <br></br>
                <br></br>
                <h1 style="color: black;font-family: Stencil; font-size: 36px; margin: 30px">Last orders</h1>
                <h:dataTable styleClass="table table-bordered table-active table-hover custom-font-style"
                             style="margin: 30px 30px 30px 30px; width: 1600px" value="#{greeter.orders}" var="item">
                    <h:column>
                        <f:facet name="header">
                            <p align="center"><h:outputText style="width: 100px;" value="Personal number"/></p>
                        </f:facet>
                        <p align="center" class="row-text">#{item.id}</p>
                    </h:column>
                    <h:column>
                        <f:facet name="header">
                            <p align="center"><h:outputText style="width: 150px;" value="Description"/></p>
                        </f:facet>
                        <p align="center" class="row-text">#{item.description}</p>
                    </h:column>
                    <h:column>
                        <f:facet name="header">
                            <p align="center"><h:outputText style="width: 150px;" value="Date/Time"/></p>
                        </f:facet>
                        <p align="center" class="row-text">#{item.date}</p>
                    </h:column>
                    <h:column>
                        <f:facet name="header">
                            <p align="center"><h:outputText style="width: 150px;" value="Status"/></p>
                        </f:facet>
                        <p align="center" class="row-text">#{item.status}</p>
                    </h:column>
                </h:dataTable>
                <h:commandButton style="display:none" id="tableUpdate" value="tableUpdate"
                                 action="#{greeter.getOrders}">
                </h:commandButton>
            </h:form>
        </div>
    </div>


    <div align="center">
        <h1 style="color: black;font-family: Stencil; font-size: 36px;margin: 30px 30px 30px 30px">Stats</h1>
        <h:form id="statsForm">
            <table class="table table-bordered table-active table-hover custom-font-style"
                   style="margin: 30px 30px 30px 30px;width: 800px">
                <thead>
                </thead>
                <tbody>
                <tr>
                    <td class="table-row-names" align="left">Trucks total:</td>
                    <td class="table-row-vals" align="right">#{greeter.statsDTO.numOfTrucksTotal}</td>
                </tr>
                <tr>
                    <td class="table-row-names" align="left">Trucks free:</td>
                    <td class="table-row-vals" align="right">#{greeter.statsDTO.numOfTrucksFree}</td>
                </tr>
                <tr>
                    <td class="table-row-names" align="left">Trucks not ready:</td>
                    <td class="table-row-vals" align="right">#{greeter.statsDTO.numOfTrucksNotReady}</td>
                </tr>
                <tr>
                    <td class="table-row-names" align="left">Trucks executing orders:</td>
                    <td class="table-row-vals" align="right">#{greeter.statsDTO.numOfTrucksExecutingOrders}</td>
                </tr>
                <tr>
                    <td class="table-row-names" align="left">Drivers total:</td>
                    <td class="table-row-vals" align="right">#{greeter.statsDTO.numOfDriversTotal}</td>
                </tr>
                <tr>
                    <td class="table-row-names" align="left">Drivers free:</td>
                    <td class="table-row-vals" align="right">#{greeter.statsDTO.numOfDriversFree}</td>
                </tr>
                <tr>
                    <td class="table-row-names" align="left">Drivers executing orders:</td>
                    <td class="table-row-vals" align="right">#{greeter.statsDTO.numOfDriversExecutingOrders}</td>
                </tr>
                </tbody>
            </table>

            <h:commandButton style="display:none" id="statsUpdate" value="statsUpdate"
                             action="#{greeter.getStatsDTO}">
            </h:commandButton>

        </h:form>
    </div>
    <br></br>
    <br></br>


    <div class="container-fluid ">
        <nav class="nav nav-tabs bg-dark navbar-dark fixed-bottom">
            <a class="navbar-brand" href="#">WWL Client</a>
        </nav>
    </div>
</div>


<script type="text/javascript">
    // var uri = "ws://" + document.location.host + document.location.pathname +

    var uri = "ws://localhost:8085/ejbgreeting/myendpoint";
    var webSocket = new WebSocket(uri);

    webSocket.onerror = function (ev) {
        webSocket = new WebSocket(uri);
    };

    webSocket.onopen = function (ev) {
        var respData = {status: 'OK'};
        var respDataString = JSON.stringify(respData);
        webSocket.send(respDataString);
    };
    webSocket.onmessage = function (ev) {
        var parsed = JSON.parse(ev.data.toString());
        if (parsed.action === 'ORDER_CREATED' || parsed.action === 'ORDER_UPDATED' || parsed.action === 'ORDER_DELETED') {
            document.getElementById('ordersListForm:tableUpdate').click();
            var respData = {status: 'OK'};
            var respDataString = JSON.stringify(respData);
            webSocket.send(respDataString);
        }
        if (parsed.action === 'STATS_UPDATED') {
            document.getElementById('statsForm:statsUpdate').click();
        }
    };
    webSocket.onclose = function (ev) {
    };

</script>

</body>


</html>